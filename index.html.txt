<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kepala Sekolah Simulator (Pixel)</title>

<style>
body{
  margin:0;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:monospace;
}
canvas{
  image-rendering:pixelated;
  border:4px solid #4caf50;
}
#hud{
  position:absolute;
  top:10px;
  left:10px;
  color:white;
  background:rgba(0,0,0,.6);
  padding:6px;
  border:2px solid #4caf50;
}
#dialog{
  position:absolute;
  bottom:20px;
  width:640px;
  background:rgba(0,0,0,.85);
  color:white;
  padding:10px;
  border:3px solid #4caf50;
  display:none;
}
#choices{
  margin-top:6px;
}
#choices button{
  margin:3px;
  padding:6px 10px;
  font-family:monospace;
  cursor:pointer;
}
</style>
</head>

<body>

<canvas id="game" width="640" height="480"></canvas>
<div id="hud"></div>

<div id="dialog">
  <div id="dialogText"></div>
  <div id="choices">
    <button id="c1"></button>
    <button id="c2"></button>
    <button id="c3"></button>
  </div>
</div>

<script>
// ================== BASIC ==================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const tileSize = 32;
const cols = 20;
const rows = 15;

// ================== LOAD IMAGE ==================
const tileset = new Image();
tileset.src = "overworld_tileset_grass.png";

const playerImg = new Image();
playerImg.src = "actor1.png";

const npcTeacherImg = new Image();
npcTeacherImg.src = "actor2.png";

const npcStudentImg = new Image();
npcStudentImg.src = "actor3.png";

// ================== MAP ==================
const map = Array.from({length:rows},()=>Array(cols).fill(0));

// ================== PLAYER ==================
const player = {
  x:5,y:5,
  dir:0, // 0 down 1 left 2 right 3 up
  frame:0,
  tick:0
};

// ================== NPC ==================
const npcs = [
  {x:8,y:5,img:npcTeacherImg,text:"Guru: Kita perlu kebijakan ramah lingkungan."},
  {x:12,y:6,img:npcStudentImg,text:"Siswa: Kantin bebas plastik yuk!"},
  {x:6,y:10,img:npcStudentImg,text:"Siswi: Sekolah hijau lebih nyaman."},
  {x:14,y:4,img:npcTeacherImg,text:"Guru: Program daur ulang perlu didukung."},
  {x:3,y:8,img:npcStudentImg,text:"Siswa: Tolong fasilitas diperbaiki."}
];

let activeNPC = null;

// ================== EVENT / PERTANYAAN ==================
let env=50, money=50, happy=50;
let step=0;

const events = [
 {q:"Kurangi sampah plastik?",a:["Larangan total","Kurangi sebagian","Abaikan"],e:[[15,-10,-5],[8,-5,0],[-15,0,-5]]},
 {q:"Tagihan listrik naik?",a:["Lampu LED","Hemat pemakaian","Biarkan"],e:[[10,-15,0],[5,0,0],[-10,0,-5]]},
 {q:"Kantin plastik?",a:["Bebas plastik","Plastik ramah","Tidak peduli"],e:[[10,-5,10],[5,-2,5],[-5,0,-5]]},
 {q:"Sampah di lapangan?",a:["Kerja bakti","Petugas","Biarkan"],e:[[10,0,5],[5,-5,0],[-5,0,-5]]},
 {q:"Taman rusak?",a:["Tanam pohon","Perbaiki sedikit","Abaikan"],e:[[10,-5,5],[5,-2,2],[-5,0,-5]]},
 {q:"Air boros?",a:["Kran hemat","Edukasi","Abaikan"],e:[[10,-5,0],[5,0,0],[-5,0,-5]]},
 {q:"Siswa terlambat?",a:["Aturan tegas","Teguran","Biarkan"],e:[[0,0,5],[0,0,2],[0,0,-5]]},
 {q:"Perpustakaan?",a:["Renovasi","Tambah buku","Abaikan"],e:[[5,-10,5],[5,-5,2],[-5,0,-5]]},
 {q:"Menu sehat?",a:["Wajib","Pilihan","Tidak"],e:[[5,-5,5],[3,-2,2],[-5,0,-5]]},
 {q:"Evaluasi akhir?",a:["Evaluasi penuh","Sebagian","Tidak"],e:[[5,0,5],[2,0,2],[-5,0,-5]]},
];

// ================== INPUT ==================
const keys={};
window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);

// ================== UPDATE ==================
function update(){
  if(keys["ArrowUp"]||keys["w"]){player.y--;player.dir=3;}
  if(keys["ArrowDown"]||keys["s"]){player.y++;player.dir=0;}
  if(keys["ArrowLeft"]||keys["a"]){player.x--;player.dir=1;}
  if(keys["ArrowRight"]||keys["d"]){player.x++;player.dir=2;}

  player.x=Math.max(0,Math.min(cols-1,player.x));
  player.y=Math.max(0,Math.min(rows-1,player.y));

  activeNPC=null;
  npcs.forEach(n=>{
    if(Math.abs(player.x-n.x)<=1 && Math.abs(player.y-n.y)<=1) activeNPC=n;
  });

  player.tick++;
  if(player.tick>10){player.frame=(player.frame+1)%3;player.tick=0;}
}

// ================== DRAW ==================
function drawMap(){
  for(let y=0;y<rows;y++){
    for(let x=0;x<cols;x++){
      ctx.drawImage(tileset,0,0,32,32,x*32,y*32,32,32);
    }
  }
}

function drawChar(img,x,y,dir,frame){
  ctx.drawImage(img,frame*32,dir*32,32,32,x*32,y*32,32,32);
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMap();
  npcs.forEach(n=>drawChar(n.img,n.x,n.y,0,0));
  drawChar(playerImg,player.x,player.y,player.dir,player.frame);

  document.getElementById("hud").innerText =
   `Lingkungan:${env}  Dana:${money}  Bahagia:${happy}`;
}

// ================== DIALOG ==================
window.addEventListener("keydown",e=>{
  if(e.key==="e" && activeNPC){
    const d=document.getElementById("dialog");
    d.style.display="block";
    document.getElementById("dialogText").innerText=
      activeNPC.text+"\n\n"+events[step].q;

    ["c1","c2","c3"].forEach((id,i)=>{
      document.getElementById(id).innerText=events[step].a[i];
      document.getElementById(id).onclick=()=>{
        env+=events[step].e[i][0];
        money+=events[step].e[i][1];
        happy+=events[step].e[i][2];
        step++;
        d.style.display="none";
        if(step>=events.length){
          alert("GAME SELESAI!");
          step=0;env=50;money=50;happy=50;
        }
      }
    });
  }
});

// ================== LOOP ==================
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>

